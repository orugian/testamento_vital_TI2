<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assistente de Testamento Vital - Testamento Vital Digital</title>
    <meta name="description" content="Crie seu testamento vital passo a passo com nosso assistente guiado. Interface intuitiva e segura." />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Ftestamento8674back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
</head>
<body class="bg-surface min-h-screen">
    <!-- Header Navigation -->
    <header class="bg-white shadow-sm border-b border-gray-100 sticky top-0 z-50">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <svg class="h-8 w-8 text-primary mr-3" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10,9 9,9 8,9"/>
                    </svg>
                    <span class="text-xl font-heading font-semibold text-primary">Testamento Vital Digital</span>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="document_dashboard.html" class="text-text-secondary hover:text-primary transition-standard">Dashboard</a>
                    <a href="about_us.html" class="text-text-secondary hover:text-primary transition-standard">Sobre</a>
                    <button type="button" class="text-text-secondary hover:text-primary transition-standard" onclick="logout()">Sair</button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button type="button" class="text-text-secondary hover:text-primary p-2" id="mobile-menu-button">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 border-t border-gray-100">
                    <a href="document_dashboard.html" class="block px-3 py-2 text-text-secondary hover:text-primary transition-standard">Dashboard</a>
                    <a href="about_us.html" class="block px-3 py-2 text-text-secondary hover:text-primary transition-standard">Sobre</a>
                    <button type="button" class="block w-full text-left px-3 py-2 text-text-secondary hover:text-primary transition-standard" onclick="logout()">Sair</button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Progress Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <h1 class="text-2xl lg:text-3xl font-heading font-semibold text-text-primary">
                    Assistente de Testamento Vital
                </h1>
                <button type="button" onclick="saveDraft()" class="btn-secondary text-sm px-4 py-2">
                    <svg class="h-4 w-4 mr-2 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                    Salvar Rascunho
                </button>
            </div>

            <!-- Progress Indicator -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-sm font-medium text-text-secondary">Progresso</span>
                    <span class="text-sm font-medium text-primary" id="progress-text">Etapa 1 de 4</span>
                </div>
                
                <!-- Desktop Progress Bar -->
                <div class="hidden md:flex items-center space-x-4">
                    <div class="flex items-center space-x-2 flex-1">
                        <div class="progress-ring complete flex items-center justify-center" id="step-1-indicator">
                            <span class="text-xs font-medium">1</span>
                        </div>
                        <div class="flex-1 h-2 bg-gray-200 rounded-full">
                            <div class="h-2 bg-primary rounded-full transition-all duration-300" id="progress-bar-1" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 flex-1">
                        <div class="progress-ring" id="step-2-indicator">
                            <span class="text-xs font-medium">2</span>
                        </div>
                        <div class="flex-1 h-2 bg-gray-200 rounded-full">
                            <div class="h-2 bg-primary rounded-full transition-all duration-300" id="progress-bar-2" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 flex-1">
                        <div class="progress-ring" id="step-3-indicator">
                            <span class="text-xs font-medium">3</span>
                        </div>
                        <div class="flex-1 h-2 bg-gray-200 rounded-full">
                            <div class="h-2 bg-primary rounded-full transition-all duration-300" id="progress-bar-3" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 flex-1">
                        <div class="progress-ring" id="step-4-indicator">
                            <span class="text-xs font-medium">4</span>
                        </div>
                        <div class="flex-1 h-2 bg-gray-200 rounded-full">
                            <div class="h-2 bg-primary rounded-full transition-all duration-300" id="progress-bar-4" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Progress Dots -->
                <div class="md:hidden flex justify-center space-x-2">
                    <div class="w-3 h-3 rounded-full bg-primary" id="mobile-step-1"></div>
                    <div class="w-3 h-3 rounded-full bg-gray-200" id="mobile-step-2"></div>
                    <div class="w-3 h-3 rounded-full bg-gray-200" id="mobile-step-3"></div>
                    <div class="w-3 h-3 rounded-full bg-gray-200" id="mobile-step-4"></div>
                </div>

                <!-- Step Labels -->
                <div class="hidden md:flex justify-between mt-3 text-xs text-text-secondary">
                    <span>Informações Pessoais</span>
                    <span>Preferências de Tratamento</span>
                    <span>Procuradores de Saúde</span>
                    <span>Diretrizes Adicionais</span>
                </div>
            </div>
        </div>

        <!-- Form Container -->
        <div class="card">
            <!-- Step 1: Personal Information -->
            <div id="step-1" class="step-content">
                <div class="mb-6">
                    <h2 class="text-xl font-heading font-semibold text-text-primary mb-2">
                        Informações Pessoais
                    </h2>
                    <p class="text-text-secondary">
                        Forneça suas informações básicas para identificação no documento.
                    </p>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label for="full-name" class="block text-sm font-medium text-text-primary mb-2">
                            Nome Completo <span class="text-accent">*</span>
                        </label>
                        <input type="text" id="full-name" name="fullName" class="form-input" placeholder="Digite seu nome completo" required />
                        <div class="validation-message" id="full-name-error"></div>
                    </div>

                    <div>
                        <label for="cpf" class="block text-sm font-medium text-text-primary mb-2">
                            CPF <span class="text-accent">*</span>
                        </label>
                        <input type="text" id="cpf" name="cpf" class="form-input" placeholder="000.000.000-00" maxlength="14" required />
                        <div class="validation-message" id="cpf-error"></div>
                    </div>

                    <div>
                        <label for="birth-date" class="block text-sm font-medium text-text-primary mb-2">
                            Data de Nascimento <span class="text-accent">*</span>
                        </label>
                        <input type="date" id="birth-date" name="birthDate" class="form-input" required />
                        <div class="validation-message" id="birth-date-error"></div>
                    </div>

                    <div>
                        <label for="rg" class="block text-sm font-medium text-text-primary mb-2">
                            RG
                        </label>
                        <input type="text" id="rg" name="rg" class="form-input" placeholder="Digite seu RG" />
                    </div>

                    <div>
                        <label for="email" class="block text-sm font-medium text-text-primary mb-2">
                            E-mail <span class="text-accent">*</span>
                        </label>
                        <input type="email" id="email" name="email" class="form-input" placeholder="seu@email.com" required />
                        <div class="validation-message" id="email-error"></div>
                    </div>

                    <div>
                        <label for="phone" class="block text-sm font-medium text-text-primary mb-2">
                            Telefone
                        </label>
                        <input type="tel" id="phone" name="phone" class="form-input" placeholder="(11) 99999-9999" />
                    </div>
                </div>

                <div class="mt-6">
                    <label for="address" class="block text-sm font-medium text-text-primary mb-2">
                        Endereço Completo <span class="text-accent">*</span>
                    </label>
                    <textarea id="address" name="address" rows="3" class="form-input" placeholder="Digite seu endereço completo" required></textarea>
                    <div class="validation-message" id="address-error"></div>
                </div>
            </div>

            <!-- Step 2: Treatment Preferences -->
            <div id="step-2" class="step-content hidden">
                <div class="mb-6">
                    <h2 class="text-xl font-heading font-semibold text-text-primary mb-2">
                        Preferências de Tratamento
                    </h2>
                    <p class="text-text-secondary">
                        Defina suas preferências para diferentes tipos de tratamento médico.
                    </p>
                </div>

                <div class="space-y-8">
                    <!-- Resuscitation -->
                    <div class="bg-surface p-6 rounded-lg">
                        <h3 class="text-lg font-medium text-text-primary mb-4">
                            Ressuscitação Cardiopulmonar (RCP)
                        </h3>
                        <p class="text-sm text-text-secondary mb-4">
                            Procedimentos para tentar reverter uma parada cardíaca ou respiratória.
                        </p>
                        <div class="space-y-3">
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="resuscitation" value="accept" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Aceito</span>
                                    <p class="text-sm text-text-secondary">Desejo que sejam realizados todos os procedimentos de ressuscitação.</p>
                                </div>
                            </label>
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="resuscitation" value="refuse" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Recuso</span>
                                    <p class="text-sm text-text-secondary">Não desejo procedimentos de ressuscitação cardiopulmonar.</p>
                                </div>
                            </label>
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="resuscitation" value="conditional" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Condicional</span>
                                    <p class="text-sm text-text-secondary">Aceito apenas em condições específicas que especificarei.</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Intubation -->
                    <div class="bg-surface p-6 rounded-lg">
                        <h3 class="text-lg font-medium text-text-primary mb-4">
                            Intubação e Ventilação Mecânica
                        </h3>
                        <p class="text-sm text-text-secondary mb-4">
                            Uso de aparelhos para auxiliar ou substituir a respiração natural.
                        </p>
                        <div class="space-y-3">
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="intubation" value="accept" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Aceito</span>
                                    <p class="text-sm text-text-secondary">Autorizo o uso de ventilação mecânica quando necessário.</p>
                                </div>
                            </label>
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="intubation" value="refuse" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Recuso</span>
                                    <p class="text-sm text-text-secondary">Não desejo ventilação mecânica invasiva.</p>
                                </div>
                            </label>
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="intubation" value="temporary" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Temporário</span>
                                    <p class="text-sm text-text-secondary">Aceito por período limitado para avaliação de recuperação.</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Artificial Nutrition -->
                    <div class="bg-surface p-6 rounded-lg">
                        <h3 class="text-lg font-medium text-text-primary mb-4">
                            Nutrição e Hidratação Artificial
                        </h3>
                        <p class="text-sm text-text-secondary mb-4">
                            Alimentação através de sondas ou via intravenosa.
                        </p>
                        <div class="space-y-3">
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="nutrition" value="accept" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Aceito</span>
                                    <p class="text-sm text-text-secondary">Autorizo nutrição e hidratação artificial.</p>
                                </div>
                            </label>
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="nutrition" value="refuse" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Recuso</span>
                                    <p class="text-sm text-text-secondary">Não desejo nutrição ou hidratação artificial.</p>
                                </div>
                            </label>
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="nutrition" value="comfort" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Apenas para Conforto</span>
                                    <p class="text-sm text-text-secondary">Aceito apenas se for para alívio de desconforto.</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Palliative Care -->
                    <div class="bg-surface p-6 rounded-lg">
                        <h3 class="text-lg font-medium text-text-primary mb-4">
                            Cuidados Paliativos
                        </h3>
                        <p class="text-sm text-text-secondary mb-4">
                            Cuidados focados no alívio da dor e melhoria da qualidade de vida.
                        </p>
                        <div class="space-y-3">
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="palliative" value="full" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Cuidados Completos</span>
                                    <p class="text-sm text-text-secondary">Desejo todos os cuidados paliativos disponíveis.</p>
                                </div>
                            </label>
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="palliative" value="pain-only" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Apenas Controle da Dor</span>
                                    <p class="text-sm text-text-secondary">Foco exclusivo no alívio da dor.</p>
                                </div>
                            </label>
                            <label class="flex items-start space-x-3 cursor-pointer">
                                <input type="radio" name="palliative" value="minimal" class="mt-1" />
                                <div>
                                    <span class="font-medium text-text-primary">Cuidados Mínimos</span>
                                    <p class="text-sm text-text-secondary">Apenas cuidados básicos de higiene e conforto.</p>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Healthcare Proxies -->
            <div id="step-3" class="step-content hidden">
                <div class="mb-6">
                    <h2 class="text-xl font-heading font-semibold text-text-primary mb-2">
                        Procuradores de Saúde
                    </h2>
                    <p class="text-text-secondary">
                        Designe pessoas de confiança para tomar decisões médicas em seu nome.
                    </p>
                </div>

                <!-- Primary Proxy -->
                <div class="bg-surface p-6 rounded-lg mb-6">
                    <h3 class="text-lg font-medium text-text-primary mb-4">
                        Procurador Principal <span class="text-accent">*</span>
                    </h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label for="proxy1-name" class="block text-sm font-medium text-text-primary mb-2">
                                Nome Completo <span class="text-accent">*</span>
                            </label>
                            <input type="text" id="proxy1-name" name="proxy1Name" class="form-input" placeholder="Nome do procurador principal" required />
                            <div class="validation-message" id="proxy1-name-error"></div>
                        </div>

                        <div>
                            <label for="proxy1-cpf" class="block text-sm font-medium text-text-primary mb-2">
                                CPF <span class="text-accent">*</span>
                            </label>
                            <input type="text" id="proxy1-cpf" name="proxy1Cpf" class="form-input" placeholder="000.000.000-00" maxlength="14" required />
                            <div class="validation-message" id="proxy1-cpf-error"></div>
                        </div>

                        <div>
                            <label for="proxy1-relationship" class="block text-sm font-medium text-text-primary mb-2">
                                Parentesco/Relação <span class="text-accent">*</span>
                            </label>
                            <select id="proxy1-relationship" name="proxy1Relationship" class="form-input" required>
                                <option value>Selecione o parentesco</option>
                                <option value="spouse">Cônjuge</option>
                                <option value="child">Filho(a)</option>
                                <option value="parent">Pai/Mãe</option>
                                <option value="sibling">Irmão/Irmã</option>
                                <option value="friend">Amigo(a)</option>
                                <option value="other">Outro</option>
                            </select>
                            <div class="validation-message" id="proxy1-relationship-error"></div>
                        </div>

                        <div>
                            <label for="proxy1-phone" class="block text-sm font-medium text-text-primary mb-2">
                                Telefone <span class="text-accent">*</span>
                            </label>
                            <input type="tel" id="proxy1-phone" name="proxy1Phone" class="form-input" placeholder="(11) 99999-9999" required />
                            <div class="validation-message" id="proxy1-phone-error"></div>
                        </div>

                        <div class="md:col-span-2">
                            <label for="proxy1-email" class="block text-sm font-medium text-text-primary mb-2">
                                E-mail
                            </label>
                            <input type="email" id="proxy1-email" name="proxy1Email" class="form-input" placeholder="email@exemplo.com" />
                        </div>
                    </div>
                </div>

                <!-- Secondary Proxy -->
                <div class="bg-surface p-6 rounded-lg">
                    <h3 class="text-lg font-medium text-text-primary mb-4">
                        Procurador Substituto (Opcional)
                    </h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label for="proxy2-name" class="block text-sm font-medium text-text-primary mb-2">
                                Nome Completo
                            </label>
                            <input type="text" id="proxy2-name" name="proxy2Name" class="form-input" placeholder="Nome do procurador substituto" />
                        </div>

                        <div>
                            <label for="proxy2-cpf" class="block text-sm font-medium text-text-primary mb-2">
                                CPF
                            </label>
                            <input type="text" id="proxy2-cpf" name="proxy2Cpf" class="form-input" placeholder="000.000.000-00" maxlength="14" />
                        </div>

                        <div>
                            <label for="proxy2-relationship" class="block text-sm font-medium text-text-primary mb-2">
                                Parentesco/Relação
                            </label>
                            <select id="proxy2-relationship" name="proxy2Relationship" class="form-input">
                                <option value>Selecione o parentesco</option>
                                <option value="spouse">Cônjuge</option>
                                <option value="child">Filho(a)</option>
                                <option value="parent">Pai/Mãe</option>
                                <option value="sibling">Irmão/Irmã</option>
                                <option value="friend">Amigo(a)</option>
                                <option value="other">Outro</option>
                            </select>
                        </div>

                        <div>
                            <label for="proxy2-phone" class="block text-sm font-medium text-text-primary mb-2">
                                Telefone
                            </label>
                            <input type="tel" id="proxy2-phone" name="proxy2Phone" class="form-input" placeholder="(11) 99999-9999" />
                        </div>

                        <div class="md:col-span-2">
                            <label for="proxy2-email" class="block text-sm font-medium text-text-primary mb-2">
                                E-mail
                            </label>
                            <input type="email" id="proxy2-email" name="proxy2Email" class="form-input" placeholder="email@exemplo.com" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 4: Additional Directives -->
            <div id="step-4" class="step-content hidden">
                <div class="mb-6">
                    <h2 class="text-xl font-heading font-semibold text-text-primary mb-2">
                        Diretrizes Adicionais
                    </h2>
                    <p class="text-text-secondary">
                        Adicione instruções específicas e revise todas as informações antes de finalizar.
                    </p>
                </div>

                <div class="space-y-6">
                    <!-- Additional Instructions -->
                    <div>
                        <label for="additional-instructions" class="block text-sm font-medium text-text-primary mb-2">
                            Instruções Adicionais
                        </label>
                        <textarea id="additional-instructions" name="additionalInstructions" rows="6" class="form-input" maxlength="2000" placeholder="Descreva qualquer instrução específica, valores pessoais, crenças religiosas ou outras considerações que devem orientar as decisões médicas..."></textarea>
                        <div class="flex justify-between mt-2">
                            <div class="text-sm text-text-secondary">
                                Use este espaço para especificar situações particulares, tratamentos específicos ou valores pessoais.
                            </div>
                            <div class="text-sm text-text-secondary">
                                <span id="char-count">0</span>/2000
                            </div>
                        </div>
                    </div>

                    <!-- Review Section -->
                    <div class="bg-surface p-6 rounded-lg">
                        <h3 class="text-lg font-medium text-text-primary mb-4">
                            Revisão do Documento
                        </h3>
                        
                        <div class="space-y-4" id="review-content">
                            <!-- Review content will be populated by JavaScript -->
                        </div>

                        <div class="mt-6 p-4 bg-warning-50 border border-warning-200 rounded-lg">
                            <div class="flex items-start">
                                <svg class="h-5 w-5 text-warning-600 mt-0.5 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                                <div>
                                    <h4 class="font-medium text-warning-800 mb-1">Importante</h4>
                                    <p class="text-sm text-warning-700">
                                        Revise cuidadosamente todas as informações antes de finalizar. 
                                        Este documento terá validade legal e orientará decisões médicas futuras.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex flex-col sm:flex-row justify-between items-center mt-8 pt-6 border-t border-gray-200 gap-4">
                <button type="button" id="prev-btn" onclick="previousStep()" class="w-full sm:w-auto bg-white text-primary border-2 border-primary px-6 py-3 rounded-md font-medium hover:bg-primary-50 transition-standard disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <svg class="h-4 w-4 mr-2 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    Anterior
                </button>

                <div class="flex space-x-3">
                    <button type="button" onclick="saveDraft()" class="bg-secondary text-white px-6 py-3 rounded-md font-medium hover:bg-secondary-800 transition-standard">
                        Salvar Rascunho
                    </button>
                    
                    <button type="button" id="next-btn" onclick="nextStep()" class="btn-primary">
                        Próximo
                        <svg class="h-4 w-4 ml-2 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>

                    <button type="button" id="finish-btn" onclick="finishWizard()" class="btn-primary hidden">
                        Finalizar Documento
                        <svg class="h-4 w-4 ml-2 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6">
            <div class="text-center">
                <div class="bg-success-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="h-8 w-8 text-success" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-text-primary mb-2">
                    Testamento Vital Criado com Sucesso!
                </h3>
                <p class="text-text-secondary mb-6">
                    Seu documento foi gerado e está disponível no seu dashboard.
                </p>
                <div class="flex space-x-3">
                    <a href="document_dashboard.html" class="btn-primary flex-1 text-center">
                        Ver Dashboard
                    </a>
                    <button type="button" onclick="closeSuccessModal()" class="bg-white text-primary border-2 border-primary px-4 py-3 rounded-md font-medium hover:bg-primary-50 transition-standard">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 4;
        let formData = {};

        // Initialize wizard
        document.addEventListener('DOMContentLoaded', function() {
            loadDraftData();
            updateProgressIndicator();
            setupFormValidation();
            setupCharacterCount();
            
            // Mobile menu toggle
            document.getElementById('mobile-menu-button').addEventListener('click', function() {
                const mobileMenu = document.getElementById('mobile-menu');
                mobileMenu.classList.toggle('hidden');
            });
        });

        // Load draft data from localStorage
        function loadDraftData() {
            const savedData = localStorage.getItem('livingWillDraft');
            if (savedData) {
                formData = JSON.parse(savedData);
                populateFormFields();
            }
        }

        // Populate form fields with saved data
        function populateFormFields() {
            Object.keys(formData).forEach(key => {
                const element = document.querySelector(`[name="${key}"]`);
                if (element) {
                    if (element.type === 'radio') {
                        const radioElement = document.querySelector(`[name="${key}"][value="${formData[key]}"]`);
                        if (radioElement) radioElement.checked = true;
                    } else {
                        element.value = formData[key];
                    }
                }
            });
        }

        // Save current step data
        function saveCurrentStepData() {
            const currentStepElement = document.getElementById(`step-${currentStep}`);
            const inputs = currentStepElement.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    if (input.checked) {
                        formData[input.name] = input.value;
                    }
                } else {
                    formData[input.name] = input.value;
                }
            });
        }

        // Validate current step
        function validateCurrentStep() {
            const currentStepElement = document.getElementById(`step-${currentStep}`);
            const requiredInputs = currentStepElement.querySelectorAll('input[required], select[required], textarea[required]');
            let isValid = true;

            requiredInputs.forEach(input => {
                const errorElement = document.getElementById(`${input.id}-error`);
                
                if (!input.value.trim()) {
                    showError(input, errorElement, 'Este campo é obrigatório.');
                    isValid = false;
                } else {
                    // Specific validations
                    if (input.type === 'email' && !isValidEmail(input.value)) {
                        showError(input, errorElement, 'Digite um e-mail válido.');
                        isValid = false;
                    } else if (input.name.includes('cpf') && !isValidCPF(input.value)) {
                        showError(input, errorElement, 'Digite um CPF válido.');
                        isValid = false;
                    } else {
                        clearError(input, errorElement);
                    }
                }
            });

            // Special validation for treatment preferences
            if (currentStep === 2) {
                const treatmentTypes = ['resuscitation', 'intubation', 'nutrition', 'palliative'];
                treatmentTypes.forEach(type => {
                    const selected = document.querySelector(`input[name="${type}"]:checked`);
                    if (!selected) {
                        showMessage(`Selecione uma opção para ${type}.`, 'error');
                        isValid = false;
                    }
                });
            }

            return isValid;
        }

        // Show error message
        function showError(input, errorElement, message) {
            input.classList.add('border-error');
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.add('error');
            }
        }

        // Clear error message
        function clearError(input, errorElement) {
            input.classList.remove('border-error');
            if (errorElement) {
                errorElement.textContent = '';
                errorElement.classList.remove('error');
            }
        }

        // Email validation
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // CPF validation
        function isValidCPF(cpf) {
            cpf = cpf.replace(/[^\d]/g, '');
            if (cpf.length !== 11) return false;
            
            // Check for known invalid patterns
            if (/^(\d)\1{10}$/.test(cpf)) return false;
            
            // Validate check digits
            let sum = 0;
            for (let i = 0; i < 9; i++) {
                sum += parseInt(cpf.charAt(i)) * (10 - i);
            }
            let remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf.charAt(9))) return false;
            
            sum = 0;
            for (let i = 0; i < 10; i++) {
                sum += parseInt(cpf.charAt(i)) * (11 - i);
            }
            remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf.charAt(10))) return false;
            
            return true;
        }

        // Next step
        function nextStep() {
            if (validateCurrentStep()) {
                saveCurrentStepData();
                
                if (currentStep < totalSteps) {
                    document.getElementById(`step-${currentStep}`).classList.add('hidden');
                    currentStep++;
                    document.getElementById(`step-${currentStep}`).classList.remove('hidden');
                    updateProgressIndicator();
                    updateNavigationButtons();
                    
                    if (currentStep === 4) {
                        generateReview();
                    }
                    
                    // Scroll to top
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            }
        }

        // Previous step
        function previousStep() {
            if (currentStep > 1) {
                saveCurrentStepData();
                document.getElementById(`step-${currentStep}`).classList.add('hidden');
                currentStep--;
                document.getElementById(`step-${currentStep}`).classList.remove('hidden');
                updateProgressIndicator();
                updateNavigationButtons();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Update progress indicator
        function updateProgressIndicator() {
            // Update progress text
            document.getElementById('progress-text').textContent = `Etapa ${currentStep} de ${totalSteps}`;
            
            // Update desktop progress
            for (let i = 1; i <= totalSteps; i++) {
                const indicator = document.getElementById(`step-${i}-indicator`);
                const progressBar = document.getElementById(`progress-bar-${i}`);
                const mobileIndicator = document.getElementById(`mobile-step-${i}`);
                
                if (i < currentStep) {
                    indicator.classList.add('complete');
                    progressBar.style.width = '100%';
                    mobileIndicator.classList.remove('bg-gray-200');
                    mobileIndicator.classList.add('bg-primary');
                } else if (i === currentStep) {
                    indicator.classList.remove('complete');
                    progressBar.style.width = '50%';
                    mobileIndicator.classList.remove('bg-gray-200');
                    mobileIndicator.classList.add('bg-primary');
                } else {
                    indicator.classList.remove('complete');
                    progressBar.style.width = '0%';
                    mobileIndicator.classList.remove('bg-primary');
                    mobileIndicator.classList.add('bg-gray-200');
                }
            }
        }

        // Update navigation buttons
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const finishBtn = document.getElementById('finish-btn');
            
            prevBtn.disabled = currentStep === 1;
            
            if (currentStep === totalSteps) {
                nextBtn.classList.add('hidden');
                finishBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                finishBtn.classList.add('hidden');
            }
        }

        // Generate review content
        function generateReview() {
            const reviewContent = document.getElementById('review-content');
            let html = '';
            
            // Personal Information
            html += `
                <div class="border-l-4 border-primary pl-4">
                    <h4 class="font-medium text-text-primary mb-2">Informações Pessoais</h4>
                    <div class="text-sm text-text-secondary space-y-1">
                        <p><strong>Nome:</strong> ${formData.fullName || 'Não informado'}</p>
                        <p><strong>CPF:</strong> ${formData.cpf || 'Não informado'}</p>
                        <p><strong>Data de Nascimento:</strong> ${formData.birthDate || 'Não informado'}</p>
                        <p><strong>E-mail:</strong> ${formData.email || 'Não informado'}</p>
                    </div>
                </div>
            `;
            
            // Treatment Preferences
            html += `
                <div class="border-l-4 border-secondary pl-4">
                    <h4 class="font-medium text-text-primary mb-2">Preferências de Tratamento</h4>
                    <div class="text-sm text-text-secondary space-y-1">
                        <p><strong>Ressuscitação:</strong> ${getPreferenceText(formData.resuscitation)}</p>
                        <p><strong>Intubação:</strong> ${getPreferenceText(formData.intubation)}</p>
                        <p><strong>Nutrição Artificial:</strong> ${getPreferenceText(formData.nutrition)}</p>
                        <p><strong>Cuidados Paliativos:</strong> ${getPreferenceText(formData.palliative)}</p>
                    </div>
                </div>
            `;
            
            // Healthcare Proxies
            html += `
                <div class="border-l-4 border-accent pl-4">
                    <h4 class="font-medium text-text-primary mb-2">Procuradores de Saúde</h4>
                    <div class="text-sm text-text-secondary space-y-1">
                        <p><strong>Procurador Principal:</strong> ${formData.proxy1Name || 'Não informado'}</p>
                        ${formData.proxy2Name ? `<p><strong>Procurador Substituto:</strong> ${formData.proxy2Name}</p>` : ''}
                    </div>
                </div>
            `;
            
            reviewContent.innerHTML = html;
        }

        // Get preference text
        function getPreferenceText(value) {
            const preferences = {
                'accept': 'Aceito',
                'refuse': 'Recuso',
                'conditional': 'Condicional',
                'temporary': 'Temporário',
                'comfort': 'Apenas para Conforto',
                'full': 'Cuidados Completos',
                'pain-only': 'Apenas Controle da Dor',
                'minimal': 'Cuidados Mínimos'
            };
            return preferences[value] || 'Não selecionado';
        }

        // Save draft
        function saveDraft() {
            saveCurrentStepData();
            localStorage.setItem('livingWillDraft', JSON.stringify(formData));
            showMessage('Rascunho salvo com sucesso!', 'success');
        }

        // Finish wizard
        function finishWizard() {
            if (validateCurrentStep()) {
                saveCurrentStepData();
                
                // Generate document ID and timestamp
                const documentId = 'DAV-' + Date.now();
                const timestamp = new Date().toISOString();
                
                // Create document object
                const document = {
                    id: documentId,
                    type: 'living_will',
                    title: `Testamento Vital - ${formData.fullName}`,
                    createdAt: timestamp,
                    updatedAt: timestamp,
                    version: '1.0',
                    status: 'active',
                    data: formData,
                    hash: generateMockHash()
                };
                
                // Save to localStorage (mock database)
                let documents = JSON.parse(localStorage.getItem('userDocuments') || '[]');
                documents.push(document);
                localStorage.setItem('userDocuments', JSON.stringify(documents));
                
                // Clear draft
                localStorage.removeItem('livingWillDraft');
                
                // Show success modal
                document.getElementById('success-modal').classList.remove('hidden');
                document.getElementById('success-modal').classList.add('flex');
            }
        }

        // Generate mock hash
        function generateMockHash() {
            return 'sha256:' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        // Close success modal
        function closeSuccessModal() {
            document.getElementById('success-modal').classList.add('hidden');
            document.getElementById('success-modal').classList.remove('flex');
        }

        // Show message
        function showMessage(message, type) {
            // Create toast notification
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 ${
                type === 'success' ? 'bg-success text-white' : 
                type === 'error' ? 'bg-error text-white' : 
                'bg-primary text-white'
            }`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Setup form validation
        function setupFormValidation() {
            // CPF formatting
            document.querySelectorAll('input[name*="cpf"]').forEach(input => {
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = value;
                });
            });
            
            // Phone formatting
            document.querySelectorAll('input[type="tel"]').forEach(input => {
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/(\d{2})(\d)/, '($1) $2');
                    value = value.replace(/(\d{5})(\d)/, '$1-$2');
                    e.target.value = value;
                });
            });
        }

        // Setup character count
        function setupCharacterCount() {
            const textarea = document.getElementById('additional-instructions');
            const charCount = document.getElementById('char-count');
            
            textarea.addEventListener('input', function() {
                charCount.textContent = this.value.length;
            });
        }

        // Logout function
        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('livingWillDraft');
            window.location.href = 'landing_page.html';
        }

        // Initialize navigation
        updateNavigationButtons();
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>